"use strict";(self.webpackChunkatlascode=self.webpackChunkatlascode||[]).push([[519],{96022:(e,t,a)=>{var n,r,s,i;a.d(t,{AQ:()=>s,IS:()=>i,U:()=>r}),function(e){e.Init="init",e.ConfigUpdate="configUpdate",e.JQLOptionsResponse="jqlOptionsResponse",e.SitesUpdate="sitesUpdate"}(n||(n={})),function(e){e.User="user",e.Workspace="workspace",e.WorkspaceFolder="workspacefolder"}(r||(r={})),function(e){e.Jira="jira",e.Bitbucket="bitbucket",e.General="general",e.Explore="explore"}(s||(s={})),function(e){e.Auth="auth",e.Issues="issues",e.Hovers="hovers",e.Triggers="triggers",e.Status="status",e.PR="pullRequests",e.Pipelines="pipelines",e.ContextMenus="contextMenus",e.PreferredRemotes="preferredRemotes",e.Misc="misc",e.Connectivity="connect",e.Debug="debug",e.JiraFeatures="jiraFeatures",e.BitbucketFeatures="bitbucketFeatures",e.StartWork="startWork"}(i||(i={}))},75981:(e,t,a)=>{a.d(t,{A:()=>l});var n=a(82096),r=a(33615),s=a(96540);const i=(0,n.A)((e=>({default:{color:"#42526E",backgroundColor:"#DFE1E6",fontWeight:"bold",textTransform:"uppercase"},inprogress:{color:"#0747A6",backgroundColor:"#DEEBFF",fontWeight:"bold",textTransform:"uppercase"},moved:{color:"#172B4D",backgroundColor:"#FFF0B3",fontWeight:"bold",textTransform:"uppercase"},new:{color:"#403294",backgroundColor:"#EAE6FF",fontWeight:"bold",textTransform:"uppercase"},removed:{color:"#BF2600",backgroundColor:"#FFEBE6",fontWeight:"bold",textTransform:"uppercase"},success:{color:"#006644",backgroundColor:"#E3FCEF",fontWeight:"bold",textTransform:"uppercase"}}))),l=({appearance:e,label:t})=>{const a=i();return s.createElement(r.A,{className:a[e],size:"small",label:t})}},45538:(e,t,a)=>{a.d(t,{q:()=>l});var n=a(54392),r=a(26758),s=a(10782),i=a(96540);const l=(0,i.memo)((({className:e})=>i.createElement(n.A,{component:"div",variant:"body1",className:e},i.createElement(r.A,{display:"inline",fontWeight:"fontWeightBold"},"Tip:"," ")," ","You can have issue keys auto-added to your commit messages using"," ",i.createElement(s.A,{href:"https://bitbucket.org/snippets/atlassian/qedp7d"},"our prepare-commit-msg hook"))))},92627:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ue});var n,r=a(2948),s=a(72007),i=a(82096),l=a(26232),o=a(29984),c=a(61434),m=a(35376),u=a(54392),p=a(26758),d=a(27606),g=a(3148),E=a(69440),h=a(73486),f=a(50384),b=a(10782),A=a(48672),v=a(64794),k=a(83220),C=a(84630),y=a(96232),S=a(96746),x=a(20426),w=a(6272),R=a(33615),W=a(83182),B=a(82290),L=a(42460),I=a(73546),O=a(8721),F=a(90345),T=a(13118),P=a(44866),z=a(29459),D=a(57965),U=a.n(D),M=a(96540),N=a(96022),j=a(6406);!function(e){e.Init="init",e.StartWorkResponse="startWorkResponse"}(n||(n={}));(0,s.YB)(j.Rc);const J={issue:(0,s.YB)(j.Rc),repoData:[]},q={workspaceRepo:{rootUri:"",mainSiteRemote:{site:void 0,remote:{name:"",isReadOnly:!0}},siteRemotes:[{site:void 0,remote:{name:"",isReadOnly:!0}}]},href:void 0,avatarUrl:void 0,localBranches:[],remoteBranches:[],branchTypes:[],developmentBranch:void 0,hasLocalChanges:void 0,branchingModel:void 0,isCloud:!1};var G,Q=a(6651),$=a(86893),H=a(9603),K=a(75981),Y=a(56872),Z=a(45538),_=a(9361),X=a(50569);!function(e){e.ClosePage="closePage",e.StartRequest="startRequest",e.OpenSettings="openSettings"}(G||(G={}));var V=a(11245),ee=a(27030),te=a(3119),ae=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function i(e){try{o(n.next(e))}catch(e){s(e)}}function l(e){try{o(n.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,l)}o((n=n.apply(e,t||[])).next())}))};const ne={postMessage:()=>{},refresh:()=>{},openLink:()=>{},startWork:()=>ae(void 0,void 0,void 0,(function*(){return{}})),closePage:()=>{},openJiraIssue:()=>{},openSettings:(e,t)=>{}},re=M.createContext(ne),se=Object.assign(Object.assign({},J),{isSomethingLoading:!1,customTemplate:"{{prefix}}/{{issueKey}}-{{summary}}",customPrefixes:[]});var ie;function le(e,t){switch(t.type){case ie.Init:console.log(`JS-1324 start work controller init repo count: ${t.data.repoData.length}`);return Object.assign(Object.assign(Object.assign({},e),t.data),{isSomethingLoading:!1,isErrorBannerOpen:!1,errorDetails:void 0});case ie.Loading:return Object.assign(Object.assign({},e),{isSomethingLoading:!0});default:return(0,_.y)(e,t)}}!function(e){e.Init="init",e.Loading="loading"}(ie||(ie={}));var oe=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function i(e){try{o(n.next(e))}catch(e){s(e)}}function l(e){try{o(n.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,l)}o((n=n.apply(e,t||[])).next())}))};const ce=(0,i.A)((e=>({title:{flexGrow:0,marginRight:e.spacing(3),marginLeft:e.spacing(1)},targetSelectLabel:{marginRight:e.spacing(1)},grow:{flexGrow:1},paper100:{overflow:"hidden",height:"100%"},paperOverflow:{overflow:"hidden"},card:{maxWidth:"600px"},leftBorder:t=>({marginLeft:e.spacing(1),borderLeftWidth:"initial",borderLeftStyle:"solid",borderLeftColor:t.settingsModifiedItemIndicator})}))),me={kind:"",prefix:""},ue=()=>{const e=(0,l.A)(),t=(0,M.useContext)($.Q),a=ce(t),[i,D]=function(){const[e,t]=(0,M.useReducer)(le,se),a=(0,M.useCallback)((e=>{e.type===n.Init&&t({type:ie.Init,data:e})}),[]),[r,s]=(0,te.G)(a),i=(0,M.useCallback)(((e,t,a,r,i,l,o)=>new Promise(((c,m)=>{(()=>{ae(this,void 0,void 0,(function*(){try{const m=yield s({type:G.StartRequest,transitionIssueEnabled:e,transition:t,wsRepo:r,branchSetupEnabled:a,sourceBranch:i,targetBranch:l,upstream:o},n.StartWorkResponse,ee.Q);c(m)}catch(e){m(e)}}))})()}))),[s]),l=(0,M.useCallback)((()=>r({type:G.ClosePage})),[r]),o=(0,M.useCallback)((()=>{t({type:ie.Loading}),r({type:X.I.Refresh})}),[r]),c=(0,M.useCallback)((e=>r({type:X.I.ExternalLink,source:V.po.StartWork,linkId:e})),[r]),m=(0,M.useCallback)((()=>r({type:X.I.OpenJiraIssue,issueOrKey:e.issue})),[r,e.issue]),u=(0,M.useCallback)(((e,a)=>{t({type:ie.Loading}),r({type:G.OpenSettings,section:e,subsection:a})}),[r]),p=(0,M.useMemo)((()=>({postMessage:r,refresh:o,openJiraIssue:m,openLink:c,startWork:i,closePage:l,openSettings:u})),[m,c,r,o,i,l,u]);return[e,p]}(),j=i.customPrefixes.map((e=>({prefix:e,kind:e}))),[J,_]=(0,M.useState)(!0),[ne,ue]=(0,M.useState)(!0),[pe,de]=(0,M.useState)(s.rv),[ge,Ee]=(0,M.useState)(q),[he,fe]=(0,M.useState)(me),[be,Ae]=(0,M.useState)({type:0,name:""}),[ve,ke]=(0,M.useState)(""),[Ce,ye]=(0,M.useState)(""),[Se,xe]=(0,M.useState)([]),[we,Re]=(0,M.useState)("initial"),[We,Be]=(0,M.useState)({}),[Le,Ie]=(0,M.useState)(!1),Oe=(0,M.useCallback)((()=>_(!J)),[J]),Fe=(0,M.useCallback)((()=>ue(!ne)),[ne]),Te=(0,M.useCallback)((e=>{de(e.target.value)}),[de]),Pe=(0,M.useCallback)((e=>{Ee(e.target.value)}),[Ee]),ze=(0,M.useCallback)(((e,t)=>{Ae(t)}),[Ae]),De=(0,M.useCallback)(((e,t)=>{fe(t)}),[fe]),Ue=(0,M.useCallback)((e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget.dataset.branchName||"",a=[...ge.localBranches,...ge.remoteBranches].find((e=>e.name===t)),n=0===a.type?a.name:a.name.substring(a.remote.length+1),r=[...ge.branchTypes,...j].find((e=>t.startsWith(e.prefix)));fe(r),setTimeout((()=>{ke(n.substring(r.prefix.length))}),100),Ae(a)}),[ge,j]),Me=(0,M.useCallback)((e=>{ke(e.target.value)}),[ke]),Ne=(0,M.useCallback)((e=>{ye(e.target.value)}),[ye]),je=(0,M.useCallback)((()=>{const e={prefix:he.prefix.replace(/ /g,"-").toLowerCase(),Prefix:he.prefix.replace(/ /g,"-"),PREFIX:he.prefix.replace(/ /g,"-").toUpperCase(),issueKey:i.issue.key,issuekey:i.issue.key.toLowerCase(),summary:i.issue.summary.substring(0,50).trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\W+/g,"-"),Summary:i.issue.summary.substring(0,50).trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\W+/g,"-"),SUMMARY:i.issue.summary.substring(0,50).trim().toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\W+/g,"-")};try{const t=U().render(i.customTemplate,e);ke(t)}catch(e){ke("Invalid template: please follow the format described above")}}),[i.issue.key,i.issue.summary,he.prefix,i.customTemplate]);(0,M.useEffect)((()=>{je()}),[he,je]);const Je=(0,M.useCallback)((()=>Ie(!1)),[Ie]),qe=(0,M.useCallback)((()=>oe(void 0,void 0,void 0,(function*(){Re("submitting");try{const e=yield D.startWork(J,pe,ne,ge.workspaceRepo,be,ve,Ce);Re("submit-success"),Be(e),Ie(!0)}catch(e){Re("initial")}}))),[D,J,pe,ne,ge,be,ve,Ce]),Ge=(0,M.useCallback)((()=>{D.openSettings(N.AQ.Jira,N.IS.StartWork)}),[D]);return(0,M.useEffect)((()=>{var e;console.log(`JS-1324 selected repo ${ge.workspaceRepo.rootUri}`),""===ge.workspaceRepo.rootUri&&i.repoData.length>0&&Ee(null===(e=i.repoData)||void 0===e?void 0:e[0])}),[ge,i.repoData]),(0,M.useEffect)((()=>{console.log(`JS-1324 repos: ${JSON.stringify(i.repoData.map((e=>e.workspaceRepo.rootUri)))}`)}),[i.repoData]),(0,M.useEffect)((()=>{var e,t,a;ye(ge.workspaceRepo.mainSiteRemote.remote.name),fe((null===(e=ge.branchTypes)||void 0===e?void 0:e[0])||me),Ae((null===(t=ge.localBranches)||void 0===t?void 0:t.find((e=>ge.developmentBranch&&e.name===ge.developmentBranch)))||(null===(a=ge.localBranches)||void 0===a?void 0:a[0])||{name:"no branches found"}),xe([...ge.localBranches.filter((e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(i.issue.key.toLowerCase())})),...ge.remoteBranches.filter((e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(i.issue.key.toLowerCase())})).filter((e=>!ge.localBranches.some((t=>e.name.endsWith(t.name)))))])}),[ge,i.issue]),(0,M.useEffect)((()=>{Re("initial")}),[]),(0,M.useEffect)((()=>{var e;const t=i.issue.transitions.find((e=>!e.isInitial&&e.to.name.toLocaleLowerCase().includes("progress")))||i.issue.transitions.find((e=>!e.isInitial))||(null===(e=i.issue.transitions)||void 0===e?void 0:e[0])||s.rv;de(t)}),[i.issue]),M.createElement(re.Provider,{value:D},M.createElement(o.A,{maxWidth:"xl"},M.createElement(c.A,{position:"relative"},M.createElement(m.A,null,M.createElement(u.A,{variant:"h3",className:a.title},"Start work"),M.createElement(p.A,{className:a.grow}),M.createElement(r.sv,{loading:i.isSomethingLoading,onClick:D.refresh}))),M.createElement(d.A,{container:!0,spacing:1},M.createElement(d.A,{item:!0,xs:12,md:12,lg:12,xl:12},M.createElement(g.A,{className:a.paper100},M.createElement(p.A,{margin:2},M.createElement(H.n,null),M.createElement(Y.O,{postMessageFunc:D.postMessage}),M.createElement(E.A,{in:"submit-success"===we},M.createElement(T.A,{variant:"standard",severity:"success"},M.createElement(P.A,null,"Success!"),M.createElement(h.A,{dense:!0},M.createElement(f.A,{disableGutters:!0},M.createElement(u.A,null,"- Assigned the issue to you")),void 0!==We.transistionStatus&&M.createElement(f.A,{disableGutters:!0},M.createElement(u.A,null,"- Transitioned status to"," ",M.createElement("strong",null,We.transistionStatus))),void 0!==We.branch&&M.createElement(f.A,{disableGutters:!0},M.createElement(u.A,null,"- Switched to ",M.createElement("strong",null,We.branch)," branch with upstream set to"," ",M.createElement("strong",null,We.upstream,"/",We.branch)))))),M.createElement(d.A,{container:!0,spacing:2,direction:"column"},M.createElement(d.A,{item:!0},M.createElement(p.A,null)),M.createElement(d.A,{item:!0},M.createElement(d.A,{container:!0,spacing:1},M.createElement(d.A,{item:!0},M.createElement(b.A,{component:"button",onClick:D.openJiraIssue},M.createElement(u.A,{variant:"h4"},M.createElement(p.A,{fontWeight:"fontWeightBold"},i.issue.key)))),M.createElement(d.A,{item:!0},M.createElement(u.A,{variant:"h4"},M.createElement(p.A,{fontWeight:"fontWeightBold"},`${i.issue.summary}`))))),M.createElement(d.A,{item:!0},M.createElement(u.A,{variant:"body2",dangerouslySetInnerHTML:{__html:i.issue.descriptionHtml}})),M.createElement(d.A,{item:!0},M.createElement(A.A,null)),M.createElement(d.A,{item:!0},M.createElement(d.A,{container:!0,spacing:1,direction:"row"},M.createElement(d.A,{item:!0},M.createElement(v.A,{color:"primary",size:"small",checked:J,onClick:Oe})),M.createElement(d.A,{item:!0},M.createElement(u.A,{variant:"h4"},M.createElement(p.A,{fontWeight:"fontWeightBold"},"Transition issue"))))),M.createElement(d.A,{item:!0},M.createElement(E.A,{in:J},M.createElement(d.A,{container:!0,spacing:2,className:a.leftBorder},M.createElement(d.A,{item:!0},M.createElement(k.A,{select:!0,size:"small",label:"Transition issue",value:pe,onChange:Te},i.issue.transitions.map((e=>M.createElement(C.A,{key:e.id,value:e},M.createElement(K.A,{appearance:Q.zK[e.to.statusCategory.colorName],label:e.to.name}))))))))),M.createElement(d.A,{item:!0},M.createElement(A.A,null)),M.createElement(d.A,{item:!0},M.createElement(d.A,{container:!0,spacing:1,direction:"row"},M.createElement(d.A,{item:!0},M.createElement(v.A,{color:"primary",size:"small",checked:ne,onClick:Fe})),M.createElement(d.A,{item:!0},M.createElement(u.A,{variant:"h4"},M.createElement(p.A,{fontWeight:"fontWeightBold"},"Set up git branch"))))),M.createElement(d.A,{item:!0},M.createElement(E.A,{in:ne},M.createElement(d.A,{container:!0,spacing:2,direction:"column",className:a.leftBorder},M.createElement(d.A,{item:!0,xs:8,md:4,lg:3,xl:3},M.createElement(k.A,{select:!0,size:"small",label:"Repository",fullWidth:!0,value:ge,onChange:Pe},i.repoData.map((e=>M.createElement(C.A,{key:e.workspaceRepo.rootUri,value:e},e.workspaceRepo.rootUri.substring(e.workspaceRepo.rootUri.lastIndexOf("/")+1)))))),M.createElement(d.A,{item:!0,xs:8,md:4,lg:3,xl:3},M.createElement(z.Ay,{options:[...ge.localBranches,...ge.remoteBranches],getOptionLabel:e=>e.name,value:be,loading:""===be.name,onChange:ze,size:"small",disableClearable:!0,openOnFocus:!0,renderInput:e=>M.createElement(k.A,Object.assign({},e,{label:"Source branch"}))})),M.createElement(d.A,{item:!0,xs:6,md:3,lg:2,xl:2},M.createElement(d.A,{container:!0,spacing:2,justify:"center",alignItems:"center"},M.createElement(d.A,{item:!0,xs:10},M.createElement(z.Ay,{id:"grouped-demo",options:[...ge.branchTypes,...j],groupBy:e=>ge.branchTypes.map((e=>e.kind)).includes(e.kind)?"Repo Branch Type":"Custom Prefix",getOptionLabel:e=>e.kind,renderInput:e=>M.createElement(k.A,Object.assign({},e,{label:"Branch Prefix",fullWidth:!0})),disableClearable:!0,value:he,onChange:De})),M.createElement(d.A,{item:!0,xs:2},M.createElement(y.Ay,{title:"Change branch-naming configuration"},M.createElement(S.A,{color:"primary",onClick:Ge},M.createElement(F.A,{fontSize:"large"})))))),M.createElement(d.A,{item:!0,xs:10,md:6,lg:4,xl:4},M.createElement(k.A,{size:"small",label:"Local branch",fullWidth:!0,value:ve,onChange:Me})),M.createElement(d.A,{item:!0,xs:8,md:4,lg:3,xl:3,hidden:ge.workspaceRepo.siteRemotes.length<=1},M.createElement(k.A,{select:!0,size:"small",label:"Set upstream to",fullWidth:!0,value:Ce,onChange:Ne},ge.workspaceRepo.siteRemotes.map((e=>M.createElement(C.A,{key:e.remote.name,value:e.remote.name},e.remote.name))))),M.createElement(d.A,{item:!0,hidden:0===Se.length},M.createElement(x.A,{raised:!0,className:a.card},M.createElement(w.A,null,M.createElement(d.A,{container:!0,spacing:1},M.createElement(d.A,{item:!0},M.createElement(O.A,null)),M.createElement(d.A,{item:!0},M.createElement(u.A,null,"Use an existing branch?"),M.createElement(u.A,{variant:"subtitle2"},"Click to use an existing branch for this issue"))),M.createElement("ul",null,Se.map((e=>{var t;return M.createElement("li",{key:e.name},M.createElement(b.A,{href:"#","data-branch-name":e.name,onClick:Ue},0===e.type?e.name:null===(t=e.name)||void 0===t?void 0:t.substring(e.remote.length+1)))}))),M.createElement(u.A,{variant:"subtitle2"},"* source branch selection is ignored for existing branches")))),M.createElement(d.A,{item:!0},M.createElement(d.A,{container:!0,spacing:1,alignItems:"flex-end"},M.createElement(d.A,{item:!0},M.createElement("svg",{width:"141.53846154px",height:"60px",viewBox:"0 0 92 39"},M.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none"},M.createElement("g",{id:"branch-diagram-create"},M.createElement("path",{d:"M86,36 C87.6568542,36 89,34.6568542 89,33 C89,31.3431458 87.6568542,30 86,30 C84.3431458,30 83,31.3431458 83,33 C83,34.6568542 84.3431458,36 86,36 Z M80.1081488,34.1399309 C65.7396146,32.2267058 58.0992007,22.7452367 57.5009625,6.05372681 L60.4990375,5.94627319 C61.0417803,21.0894001 67.5381337,29.3713241 80.2936839,31.1405887 C81.0763531,28.7370585 83.3353207,27 86,27 C89.3137085,27 92,29.6862915 92,33 C92,36.3137085 89.3137085,39 86,39 C83.076066,39 80.6406301,36.9084914 80.1081488,34.1399309 Z",id:"Combined-Shape",fill:"#5E6C84",fillRule:"nonzero"}),M.createElement("path",{d:"M53.3414114,8 L11.6585886,8 C10.8349158,10.3303847 8.61243765,12 6,12 C2.6862915,12 0,9.3137085 0,6 C0,2.6862915 2.6862915,0 6,0 C8.61243765,0 10.8349158,1.66961525 11.6585886,4 L53.3414114,4 C54.1650842,1.66961525 56.3875623,0 59,0 C62.3137085,0 65,2.6862915 65,6 C65,9.3137085 62.3137085,12 59,12 C56.3875623,12 54.1650842,10.3303847 53.3414114,8 Z",id:"Combined-Shape",fill:e.palette.primary.main}))))),M.createElement(d.A,{item:!0},M.createElement(d.A,{container:!0,spacing:1,direction:"column"},M.createElement(d.A,{item:!0},M.createElement(R.A,{variant:"outlined",color:"primary",label:be.name})),M.createElement(d.A,{item:!0},M.createElement(R.A,{variant:"outlined",color:"primary",label:`${ve}`}))))))))),M.createElement(d.A,{item:!0,hidden:"submit-success"===we},M.createElement(S.A,{variant:"contained",color:"primary",disabled:"submitting"===we,onClick:qe,endIcon:"submitting"===we?M.createElement(W.A,{color:"inherit",size:e.typography.fontSize}):null},"Start")),M.createElement(d.A,{item:!0,hidden:"submit-success"===we},M.createElement(Z.q,null)),M.createElement(d.A,{item:!0,hidden:"submit-success"!==we},M.createElement(S.A,{variant:"contained",color:"default",onClick:D.closePage},"Close")),M.createElement(d.A,{item:!0,hidden:"submit-success"!==we},M.createElement(B.A,{open:Le,onClose:Je,autoHideDuration:6e3,anchorOrigin:{vertical:"bottom",horizontal:"left"}},M.createElement(T.A,{variant:"standard",severity:"success",action:M.createElement(L.A,{"aria-label":"close",color:"inherit",size:"small",onClick:Je},M.createElement(I.A,{fontSize:"inherit"}))},M.createElement(P.A,null,"Success!"),M.createElement("p",null,"See details at the top of this page")))))))))))}}}]);