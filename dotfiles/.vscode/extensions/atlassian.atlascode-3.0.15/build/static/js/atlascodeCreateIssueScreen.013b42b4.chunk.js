"use strict";(self.webpackChunkatlascode=self.webpackChunkatlascode||[]).push([[464],{32196:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var a=s(96540),i=s(88097),n=s(31074),l=s(6406),r=s(5624),c=s(32456),d=s(30801),o=s(53828),h=s(46569),m=s(32935),u=s(93420),p=s(23588),g=s(24788),f=s(70376),y=s(50653),E=s(14596),b=s(98422),v=s(63489),k=s(97503),F=s(59854),O=s(69984),S=s(67459),M=s(59927),V=function(e,t,s,a){return new(s||(s=Promise))((function(i,n){function l(e){try{c(a.next(e))}catch(e){n(e)}}function r(e){try{c(a.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,r)}c((a=a.apply(e,t||[])).next())}))};const P=Object.assign(Object.assign(Object.assign({},i.b),n.tm),{isCreateBannerOpen:!1,createdIssue:{key:"",siteDetails:l.Rc}}),j=e=>a.createElement(p.c.Option,Object.assign({},e),a.createElement("div",Object.assign({ref:e.innerRef},e.innerProps,{style:{display:"flex",alignItems:"center"}}),a.createElement("img",{src:e.data.avatarUrl,width:"24",height:"24"}),a.createElement("span",{style:{marginLeft:"10px"}},e.data.name))),A=e=>a.createElement(p.c.SingleValue,Object.assign({},e),a.createElement("div",{style:{display:"flex",alignItems:"center"}},a.createElement("img",{src:e.data.avatarUrl,width:"16",height:"16"}),a.createElement("span",{style:{marginLeft:"10px"}},e.data.name)));class C extends i.i{getProjectKey(){return this.state.fieldValues.project.key}constructor(e){super(e),this.advancedFields=[],this.commonFields=[],this.handleSubmit=e=>V(this,void 0,void 0,(function*(){let e=Object.values(this.state.fields).filter((e=>e.required)),t={};if(e.forEach((e=>{if(e.uiType===r.HC.Worklog&&this.state.fieldValues[`${e.key}.enabled`]){const s=this.state.fieldValues[`${e.key}.timeSpent`],a=this.state.fieldValues[`${e.key}.newEstimate`],i=this.state.fieldValues[`${e.key}.started`],n=this.state.fieldValues[`${e.key}.comment`];(void 0===s||s.length<1)&&(t[`${e.key}.timeSpent`]="EMPTY"),(void 0===a||a.length<1)&&(t[`${e.key}.newEstimate`]="EMPTY"),(void 0===i||i.length<1)&&(t[`${e.key}.started`]="EMPTY"),(void 0===n||n.length<1)&&(t[`${e.key}.comment`]="EMPTY")}const s=this.state.fieldValues[e.key];(void 0===s||s.length<1)&&(t[e.key]="EMPTY")})),Object.keys(t).length>0)return t;this.setState({isSomethingLoading:!0,loadingField:"submitButton",isCreateBannerOpen:!1}),this.postMessage({action:"createIssue",site:this.state.siteDetails,issueData:this.state.fieldValues})})),this.handleSiteChange=e=>{this.setState({siteDetails:e,loadingField:"site",isSomethingLoading:!0}),this.postMessage({action:"getScreensForSite",site:e})},this.handleInlineEdit=(e,t)=>V(this,void 0,void 0,(function*(){let s=t,a=e.key;if(void 0!==s){if(e.valueType===r.eV.Number&&"number"!==typeof t&&(s=parseFloat(t)),e.key.indexOf(".")>-1){let t={};const i=e.key.split(".");a=i[0],this.state.fieldValues[i[0]]&&(t=this.state.fieldValues[i[0]]),t[i[1]]=s,s=t}if(e.uiType===r.HC.Attachment&&Array.isArray(t)&&t.length>0){s=t.map((e=>({lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,path:e.path})))}this.setState({fieldValues:Object.assign(Object.assign({},this.state.fieldValues),{[a]:s})}),e.valueType===r.eV.Project&&(this.setState({loadingField:e.key,isSomethingLoading:!0}),this.postMessage({action:"getScreensForProject",project:t,fieldValues:this.state.fieldValues})),e.valueType===r.eV.IssueType&&(this.setState({loadingField:e.key,isSomethingLoading:!0}),this.postMessage({action:"setIssueType",issueType:t,fieldValues:this.state.fieldValues}))}else this.setState({fieldValues:Object.assign(Object.assign({},this.state.fieldValues),{[a]:s})})})),this.fetchUsers=e=>this.loadSelectOptions(e,`${this.state.siteDetails.baseApiUrl}/api/${this.state.apiVersion}/user/search?${this.state.siteDetails.isCloud?"query":"username"}=`),this.state=P}onMessageReceived(e){let t=super.onMessageReceived(e);if(!t)switch(e.type){case"update":{t=!0;const s=e;this.updateInternals(s),this.setState(s,(()=>{this.setState({isSomethingLoading:!1,loadingField:""})}));break}case"currentUserUpdate":t=!0,this.setState({currentUser:e.currentUser});break;case"issueCreated":t=!0,(0,n.QX)(e)&&this.setState({isErrorBannerOpen:!1,errorDetails:void 0,isSomethingLoading:!1,loadingField:"",isCreateBannerOpen:!0,createdIssue:e.issueData,fieldValues:Object.assign(Object.assign({},this.state.fieldValues),{description:"",summary:""})})}return t}updateInternals(e){const t=this.sortFieldValues(e.fields);this.advancedFields=[],this.commonFields=[],t.forEach((e=>{e.advanced?this.advancedFields.push(e):this.commonFields.push(e)}))}getCommonFieldMarkup(){return this.commonFields.map((e=>this.getInputMarkup(e)))}getAdvancedFieldMarkup(){return this.advancedFields.map((e=>this.getInputMarkup(e)))}render(){return!this.state.fieldValues.issuetype||""===this.state.fieldValues.issuetype.id&&!this.state.isErrorBannerOpen&&this.state.isOnline?(this.postMessage({action:"refresh"}),a.createElement(f.V,null)):a.createElement(h.Ay,null,a.createElement(m.A,null,a.createElement(u.A,{medium:8},a.createElement("div",null,!this.state.isOnline&&a.createElement(v.A,null),this.state.showPMF&&a.createElement(k.A,{onPMFOpen:()=>this.onPMFOpen(),onPMFVisiblity:e=>this.setState({showPMF:e}),onPMFLater:()=>this.onPMFLater(),onPMFNever:()=>this.onPMFNever(),onPMFSubmit:e=>this.onPMFSubmit(e)}),this.state.isCreateBannerOpen&&a.createElement("div",{className:"fade-in"},a.createElement(O.A,{appearance:"confirmation",title:"Issue Created"},a.createElement("p",null,"Issue"," ",a.createElement(y.A,{className:"ac-banner-link-button",appearance:"link",spacing:"none",onClick:()=>{this.handleOpenIssue(this.state.createdIssue)}},this.state.createdIssue.key)," ","has been created."))),this.state.isErrorBannerOpen&&a.createElement(E.A,{onDismissError:this.handleDismissError,errorDetails:this.state.errorDetails}),a.createElement("div",{className:"ac-vpadding"},a.createElement("div",{className:"ac-flex"},a.createElement("h2",null,"Create Issue"),this.state.isSomethingLoading&&a.createElement("div",{className:"spinner",style:{marginLeft:"15px"}},a.createElement(S.A,{size:"medium"})))),a.createElement(c.Ay,{name:"create-issue",onSubmit:this.handleSubmit},(e=>a.createElement("form",Object.assign({},e.formProps),a.createElement(d.A,{label:"Select Site",id:"site",name:"site",defaultValue:this.state.siteDetails},(e=>a.createElement(g.A,Object.assign({},e.fieldProps,{className:"ac-select-container",classNamePrefix:"ac-select",getOptionLabel:e=>e.name,getOptionValue:e=>e.id,options:this.state.selectFieldOptions.site,components:{Option:j,SingleValue:A},onChange:(0,M.cy)(e.fieldProps.onChange,this.handleSiteChange)})))),this.getCommonFieldMarkup(),this.commonFields&&1===this.commonFields.length&&a.createElement("div",{className:"ac-vpadding"},a.createElement("h3",null,"No fields found for selected project. Please choose another.")),this.advancedFields&&this.advancedFields.length>0&&a.createElement(F.A,{isDefaultExpanded:!1,header:a.createElement("h4",null,"Advanced Options")},a.createElement("div",null,this.getAdvancedFieldMarkup())),a.createElement(o.A,{actions:{}},a.createElement(b.A,{type:"submit",className:"ac-button",isDisabled:this.state.isSomethingLoading,isLoading:"submitButton"===this.state.loadingField},"Submit"))))),this.state.transformerProblems&&Object.keys(this.state.transformerProblems).length>0&&a.createElement("div",{className:"fade-in",style:{marginTop:"20px"}},a.createElement("span",null,"non-renderable fields detected.")," ",a.createElement(y.A,{className:"ac-banner-link-button",appearance:"link",spacing:"none",onClick:()=>{this.postMessage({action:"openProblemReport"})}},"View a problem report"))))))}}}}]);