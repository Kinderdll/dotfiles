"use strict";(self.webpackChunkatlascode=self.webpackChunkatlascode||[]).push([[245],{95313:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Qe});var a=s(7903),i=s(98422),n=s(31617),l=s(73960),r=s(6034),c=s(68940),o=s(95995),d=s(49560),h=s(68972),m=s(73477),u=s(39494),p=s(46569),g=s(32935),E=s(93420),v=s(12908),f=s(78464),y=s(5624),k=s(13626),b=s(84929),S=s(96540),A=s(962),C=s(68414),w=s.n(C),N=s(31074),D=s(27030),I=s(70376),V=s(14596),x=s(63489),M=s(97503),O=s(88097),L=s(50653),U=s(93297),F=s(90585),P=s(94969),j=s(44378),W=s(58256),R=s(91139),z=s.n(R),T=s(64834),$=s(7135);const B=e=>S.createElement("div",{className:"ac-delete",onClick:()=>e.delfunc(e.attachment)},S.createElement(F.A,{label:"trash"})),q=e=>S.createElement(v.A,{content:"View in browser"},S.createElement(L.A,{className:"ac-link-button",appearance:"link",iconBefore:S.createElement(U.A,{size:"small",label:"open-attachment"}),href:`${e.baseLinkUrl}/rest/api/2/attachment/content/${e.attachment.id}`})),K=e=>{const t="number"===typeof e.attachment.size?e.attachment.size:parseFloat(e.attachment.size),s=z()(t);return S.createElement("p",{style:{display:"inline"}},s)},H=({baseLinkUrl:e,attachments:t,onDelete:s,fetchImage:a})=>{const[i,n]=(0,S.useState)(void 0);return S.createElement(S.Fragment,null,S.createElement(W.A,{columns:[e=>$.g.includes(e.attachment.mimeType)?S.createElement("a",{style:{display:"inline"},href:"#",onClick:()=>n(e.attachment)},e.attachment.filename):S.createElement("p",null,e.attachment.filename),q,K,B],columnWidths:["100%","50px","150px","50px"],items:t.map((t=>({id:t.id,content:{baseLinkUrl:e,attachment:t,delfunc:s}})))}),S.createElement(P.A,null,i&&S.createElement(j.A,{heading:i.filename,shouldCloseOnEscapePress:!0,width:"x-large",onClose:()=>n(void 0)},S.createElement(T.t,{html:`<img src=${i.content} />`,fetchImage:a}))))},G=[],Q=({isOpen:e,onSave:t,onCancel:s})=>{const[i,n]=(0,S.useState)(G);return e?S.createElement(P.A,null,S.createElement(j.A,{onClose:s,heading:"Add Attachment",shouldCloseOnEscapePress:!1},S.createElement($.S,{onFilesChanged:n}),S.createElement(a.A,null,S.createElement(L.A,{className:"ac-button",onClick:()=>{t(i)},isDisabled:i.length<1},"Save"),S.createElement(L.A,{className:"ac-button",onClick:s},"Cancel")))):S.createElement(S.Fragment,null)};var Y=s(85832),X=s(63342),J=s(52295),_=s(41201),Z=s(25229),ee=s(38020),te=s(71210),se=s(64837),ae=function(e,t,s,a){return new(s||(s=Promise))((function(i,n){function l(e){try{c(a.next(e))}catch(e){n(e)}}function r(e){try{c(a.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,r)}c((a=a.apply(e,t||[])).next())}))};const ie=({siteDetails:e,comment:t,isServiceDeskProject:s,fetchUsers:i,onSave:n,onDelete:l,fetchImage:r})=>{const[c,o]=(0,S.useState)(!1),[d,h]=(0,S.useState)(t.body),[m,u]=(0,S.useState)(!1),p=`${(0,k.m)((0,b.H)(t.created))} ago`,g=t.renderedBody?t.renderedBody:t.body,E=s?t.jsdPublic?"external":"internal":void 0;return c&&!m?S.createElement(S.Fragment,null,S.createElement(X.A,{avatar:S.createElement(Y.A,{src:t.author.avatarUrls["48x48"],label:"Atlaskit avatar",size:"medium"}),author:S.createElement(J.A,null,S.createElement("div",{className:"jira-comment-author"},t.author.displayName)),content:S.createElement(S.Fragment,null,S.createElement(se.S,{value:d,fetchUsers:t=>ae(void 0,void 0,void 0,(function*(){return(yield i(t)).map((t=>{var s;return{displayName:t.displayName,avatarUrl:null===(s=t.avatarUrls)||void 0===s?void 0:s["48x48"],mention:e.isCloud?`[~accountid:${t.accountId}]`:`[~${t.name}]`}}))})),disabled:m,onChange:e=>h(e)}),S.createElement(a.A,null,S.createElement(L.A,{className:"ac-button",onClick:()=>{n(d,t.id,void 0),u(!0)},isDisabled:m},s?"Reply to customer":"Save"),s&&S.createElement(L.A,{className:"ac-button",onClick:()=>{n(d,t.id,te.w9),u(!0)},isDisabled:m},"Add internal note"),S.createElement(L.A,{appearance:"default",onClick:()=>{o(!1),h(t.body)}},"Cancel")))})):S.createElement(X.A,{avatar:S.createElement(Y.A,{src:t.author.avatarUrls["48x48"],label:"Atlaskit avatar",size:"medium"}),author:S.createElement(J.A,null,S.createElement("div",{className:"jira-comment-author"},t.author.displayName)),time:S.createElement(_.A,null,p),edited:t.created!==t.updated?S.createElement(Z.A,null,"Edited"):null,type:E,content:m?S.createElement("p",{style:{whiteSpace:"pre-wrap",opacity:.5}},d):S.createElement("div",{className:"jira-comment"},S.createElement(T.t,{html:g,fetchImage:r})),isSaving:m,actions:e.userId===t.author.accountId?[S.createElement(ee.A,{onClick:()=>o(!0)},"Edit"),S.createElement(ee.A,{onClick:()=>{l(t.id),h(""),u(!0)}},"Delete")]:[]})};var ne=s(10453),le=s(79402);const re=e=>S.createElement("div",{className:"ac-flex-space-between"},S.createElement("div",{style:{width:"16px",height:"16px"}},S.createElement(v.A,{content:e.issue.issuetype.name},S.createElement("img",{src:e.issue.issuetype.iconUrl}))),S.createElement(L.A,{appearance:"subtle-link",onClick:()=>e.onIssueClick({siteDetails:e.issue.siteDetails,key:e.issue.key})},e.issue.key)),ce=e=>S.createElement("p",{style:{display:"inline"}},e.issue.summary),oe=e=>e.issue.priority&&e.issue.priority.name&&e.issue.priority.iconUrl?S.createElement("div",{style:{width:"16px",height:"16px"}},S.createElement(v.A,{content:e.issue.priority.name},S.createElement("img",{src:e.issue.priority.iconUrl}))):S.createElement(S.Fragment,null),de=e=>{if(e.issue.status&&e.issue.status.statusCategory){const t=le.zK[e.issue.status.statusCategory.colorName];return S.createElement(ne.A,{appearance:t},e.issue.status.name)}return S.createElement(S.Fragment,null)};class he extends S.Component{constructor(e){super(e)}render(){return S.createElement(W.A,{columns:[re,ce,oe,de],columnWidths:["150px","100%","20px","150px"],items:this.props.issues.map((e=>({id:e.key,content:{issue:e,onIssueClick:this.props.onIssueClick}})))})}}const me=e=>{const t=e.issue.issuetype&&e.issue.issuetype.name&&e.issue.issuetype.iconUrl?S.createElement("div",{style:{width:"16px",height:"16px"}},S.createElement(v.A,{content:e.issue.issuetype.name},S.createElement("img",{src:e.issue.issuetype.iconUrl}))):S.createElement(S.Fragment,null);return S.createElement("div",{className:"ac-flex-space-between"},S.createElement("p",{style:{display:"inline"}},S.createElement("em",{style:{position:"absolute",bottom:"2.25em"}},e.linkDescription)),t,S.createElement(L.A,{appearance:"subtle-link",onClick:()=>e.onIssueClick({siteDetails:e.issue.siteDetails,key:e.issue.key})},e.issue.key))},ue=e=>S.createElement("p",{style:{display:"inline"}},e.issue.summary),pe=e=>e.issue.priority&&e.issue.priority.name&&e.issue.priority.iconUrl?S.createElement("div",{style:{width:"16px",height:"16px"}},S.createElement(v.A,{content:e.issue.priority.name},S.createElement("img",{src:e.issue.priority.iconUrl}))):S.createElement(S.Fragment,null),ge=e=>{if(e.issue.status&&e.issue.status.statusCategory){const t=le.zK[e.issue.status.statusCategory.colorName];return S.createElement(ne.A,{appearance:t},e.issue.status.name)}return S.createElement(S.Fragment,null)},Ee=({issuelinks:e,onIssueClick:t,onDelete:s})=>S.createElement(W.A,{columns:[me,ue,pe,ge],columnWidths:["150px","100%","20px","150px"],items:e.map((e=>({id:e.id,content:{linkDescription:e.inwardIssue?e.type.inward:e.type.outward,issue:e.inwardIssue||e.outwardIssue,onIssueClick:t,onDelete:s}})))});var ve=s(82522);class fe extends S.Component{avatar(e){const t=e.author.avatarUrl;return t?S.createElement(Y.A,{src:t,size:"small"}):S.createElement("div",null)}prState(e){switch(e.state){case"MERGED":return S.createElement(ne.A,{appearance:"success"},"Merged");case"SUPERSEDED":return S.createElement(ne.A,{appearance:"moved"},"Superseded");case"OPEN":return S.createElement(ne.A,{appearance:"inprogress"},"Open");case"DECLINED":return S.createElement(ne.A,{appearance:"removed"},"Declined");default:return S.createElement("div",null)}}render(){return this.props.pullRequests.map((e=>S.createElement("div",{key:e.url,style:{display:"flex",alignItems:"center"}},this.avatar(e),S.createElement(L.A,{appearance:"link",onClick:()=>this.props.onClick(e)},`${e.destination.repo.displayName} - Pull request #${e.id}`),this.prState(e))))}}var ye=s(99650),ke=s(71073);const be={isLoading:!1};class Se extends S.Component{constructor(e){super(e),this.toggleVote=()=>{this.props.votes.hasVoted?(this.props.onRemoveVote(this.props.currentUser),this.setState(Object.assign({},be)),this.props.onClose()):this.handleAddVote(this.props.currentUser)},this.handleAddVote=e=>{this.props.onAddVote(e),this.setState(Object.assign({},be)),this.props.onClose()},this.getEmptyVoters=()=>{const e=[S.createElement(Y.A,{size:"large"}),S.createElement(Y.A,{size:"large"}),S.createElement(Y.A,{size:"large"}),S.createElement(Y.A,{size:"large"})];return S.createElement("div",null,S.createElement(ke.A,{appearance:"stack",data:e,size:"large"}),S.createElement("span",null,"No voters yet"))},this.getStartStop=()=>this.props.votes.hasVoted?S.createElement("div",{className:"ac-icon-with-text ac-inline-watcher-hover",style:{cursor:"pointer"},onClick:this.toggleVote},S.createElement(d.A,{label:"starfilledicon",size:"medium"}),S.createElement("span",{style:{marginLeft:"8px"}},"Remove vote")):S.createElement("div",{className:"ac-icon-with-text ac-inline-watcher-hover",style:{cursor:"pointer"},onClick:this.toggleVote},S.createElement(o.A,{label:"staricon",size:"medium"}),S.createElement("span",{style:{marginLeft:"8px"}},"Vote for this issue")),this.getVoters=()=>{if(this.props.votes.votes<1)return this.getEmptyVoters();let e=this.props.votes.voters.map((e=>{let t=e.avatarUrls&&e.avatarUrls["24x24"]?e.avatarUrls["24x24"]:"";return S.createElement("div",{className:"ac-inline-watcher ac-inline-watcher-hover"},S.createElement(Y.A,{size:"small",src:t}),S.createElement("div",{className:"ac-inline-watcher-name"},e.displayName))}));return S.createElement("div",null,S.createElement("div",{className:"ac-inline-watcher-list-heading"},"voted for this issue"),e)},this.state=Object.assign({},be)}render(){return S.createElement("div",{className:"ac-inline-items-container"},this.props.allowVoting&&S.createElement("div",{className:"ac-inline-item"},this.getStartStop()),S.createElement("div",{className:"ac-inline-item"},this.getVoters()))}}var Ae=s(3672),Ce=s(20181),we=s.n(Ce),Ne=s(47292);const De={isLoading:!1};class Ie extends S.Component{constructor(e){super(e),this.toggleWatching=()=>{this.props.watches.isWatching?(this.props.onRemoveWatcher(this.props.currentUser),this.setState(Object.assign({},De)),this.props.onClose()):this.handleAddWatcher(this.props.currentUser)},this.handleAddWatcher=e=>{this.props.onAddWatcher(e),this.setState(Object.assign({},De)),this.props.onClose()},this.getEmptyWatchers=()=>{const e=[S.createElement(Y.A,{size:"large"}),S.createElement(Y.A,{size:"large"}),S.createElement(Y.A,{size:"large"}),S.createElement(Y.A,{size:"large"})];return S.createElement("div",null,S.createElement(ke.A,{appearance:"stack",data:e,size:"large"}),S.createElement("span",null,"No watchers yet"))},this.getStartStop=()=>this.props.watches.isWatching?S.createElement("div",{className:"ac-icon-with-text ac-inline-watcher-hover",style:{cursor:"pointer"},onClick:this.toggleWatching},S.createElement(m.A,{label:"watchfilledicon",size:"medium"}),S.createElement("span",{style:{marginLeft:"8px"}},"Stop watching")):S.createElement("div",{className:"ac-icon-with-text ac-inline-watcher-hover",style:{cursor:"pointer"},onClick:this.toggleWatching},S.createElement(h.A,{label:"watchicon",size:"medium"}),S.createElement("span",{style:{marginLeft:"8px"}},"Start watching")),this.getWatchers=()=>{if(this.props.watches.watchCount<1)return this.getEmptyWatchers();let e=this.props.watches.watchers.map((e=>{let t=e.avatarUrls&&e.avatarUrls["24x24"]?e.avatarUrls["24x24"]:"";return S.createElement("div",{className:"ac-inline-watcher ac-inline-watcher-hover"},S.createElement(Y.A,{size:"small",src:t}),S.createElement("div",{className:"ac-inline-watcher-name"},e.displayName),S.createElement("div",{className:"ac-inline-watcher-delete",onClick:()=>this.props.onRemoveWatcher(e)}))}));return S.createElement("div",null,S.createElement("div",{className:"ac-inline-watcher-list-heading"},"watching this issue"),e)},this.state=Object.assign({},De)}render(){const e={isMulti:!1,className:"ac-select-container",classNamePrefix:"ac-select",getOptionLabel:Ne.nM(y.eV.User),getOptionValue:Ne.SY(y.eV.User),components:Ne.th(y.eV.User),placeholder:"Add watchers"};return S.createElement("div",{className:"ac-inline-items-container"},S.createElement("div",{className:"ac-inline-item"},this.getStartStop()),S.createElement("div",{className:"ac-inline-item"},this.getWatchers()),S.createElement("div",{className:"ac-inline-item"},S.createElement(Ae.A,Object.assign({},e,{isLoading:this.state.isLoading,onChange:we()(this.handleAddWatcher,100),loadOptions:this.props.onFetchUsers}))))}}var Ve=s(56668),xe=s(44750),Me=s(32456),Oe=s(30801),Le=s(23048),Ue=s(52556),Fe=s(53828),Pe=s(70892),je=s(59927);const We={comment:"",started:"",timeSpent:"",newEstimate:"",autoAdjust:!0},Re="yyyy-MM-dd'T'HH:mm:ss.SSSXX";class ze extends S.Component{constructor(e){super(e),this.handleClose=()=>{this.setState(Object.assign({},We)),this.props.onCancel()},this.disableSaving=()=>""===this.state.started||""===this.state.timeSpent.trim()||!this.state.autoAdjust&&""===this.state.newEstimate.trim(),this.handleSave=e=>{const t={comment:e.comment,started:(0,Pe.GP)(new Date(e.started),Re),timeSpent:e.timeSpent,adjustEstimate:e.newEstimate&&""!==e.newEstimate?"new":"auto",newEstimate:e.newEstimate};this.props.onSave&&this.props.onSave(t),this.handleClose()},this.state=Object.assign(Object.assign({},We),{savingDisabled:!0,started:(0,Pe.GP)(Date.now(),Re)})}render(){const e=""!==this.state.started.trim()?this.state.started:(0,Pe.GP)(Date.now(),Re);return S.createElement("div",null,S.createElement(Me.Ay,{name:"worklog-form",onSubmit:this.handleSave},(t=>S.createElement("form",Object.assign({},t.formProps),S.createElement(Oe.A,{label:"Description",isRequired:!1,id:"comment",name:"comment",defaultValue:this.state.comment},(e=>S.createElement("textarea",Object.assign({},e.fieldProps,{style:{width:"100%",display:"block"},className:"ac-textarea",rows:3,onChange:je.cy(e.fieldProps.onChange,(e=>{this.setState({comment:e.target.value},(()=>{this.setState({savingDisabled:this.disableSaving()})}))}))})))),S.createElement(Oe.A,{label:"Date",id:"started",name:"started",isRequired:!0,validate:je.oI,defaultValue:e},(t=>{let s=S.createElement("span",null);return"EMPTY"===t.error&&(s=S.createElement(Le.Kw,null,"Date is required")),S.createElement("div",null,S.createElement(xe.A,{defaultValue:e,timeIsEditable:!0,className:"ac-select-container",datePickerSelectProps:{className:"ac-select-container",classNamePrefix:"ac-select"},timePickerSelectProps:{className:"ac-select-container",classNamePrefix:"ac-select"},onChange:je.cy(t.fieldProps.onChange,(e=>{document.activeElement.blur(),this.setState({started:e},(()=>{this.setState({savingDisabled:this.disableSaving()})}))}))}),s)})),S.createElement(Oe.A,{label:"Time spent",id:"timeSpent",name:"timeSpent",isRequired:!0,defaultValue:this.state.timeSpent,validate:je.oI},(e=>{let t=S.createElement("span",null);return"EMPTY"===e.error&&(t=S.createElement(Le.Kw,null,"Time spent is required")),S.createElement("div",null,S.createElement("input",Object.assign({},e.fieldProps,{style:{width:"100%",display:"block"},className:"ac-inputField",onChange:je.cy(e.fieldProps.onChange,(e=>{this.setState({timeSpent:e.target.value},(()=>{this.setState({savingDisabled:this.disableSaving()})}))}))})),S.createElement(Le.st,null,"(eg. 3w 4d 12h)"),t)})),S.createElement(Ue.A,{name:"autoAdjust",id:"autoAdjust",value:"autoAdjust",defaultIsChecked:this.state.autoAdjust},(e=>S.createElement(Ve.S,Object.assign({},e.fieldProps,{label:"Auto adjust remaining estimate",onChange:je.cy(e.fieldProps.onChange,(e=>{this.setState({autoAdjust:e.target.checked},(()=>{this.setState({savingDisabled:this.disableSaving()})}))}))})))),!this.state.autoAdjust&&S.createElement(Oe.A,{label:"Remaining estimate",id:"newEstimate",name:"newEstimate",isRequired:!this.state.autoAdjust,defaultValue:this.state.newEstimate,validate:je.oI},(e=>{let t=S.createElement("span",null);return"EMPTY"===e.error&&(t=S.createElement(Le.Kw,null,"Remaining estimate is required")),S.createElement("div",null,S.createElement("div",{className:"ac-flex"},S.createElement("input",Object.assign({},e.fieldProps,{disabled:this.state.autoAdjust,style:{width:"100%",display:"block"},className:"ac-inputField",onChange:je.cy(e.fieldProps.onChange,(e=>{this.setState({newEstimate:e.target.value},(()=>{this.setState({savingDisabled:this.disableSaving()})}))}))}))),S.createElement(Le.st,null,"(eg. 3w 4d 12h) original estimate ",this.props.originalEstimate),t)})),S.createElement(Fe.A,{actions:{}},S.createElement("div",{style:{display:"inline-flex",marginRight:"4px",marginLeft:"4px;"}},S.createElement(L.A,{type:"submit",className:"ac-button",isDisabled:this.state.savingDisabled},"Submit")),S.createElement("div",{style:{display:"inline-flex",marginRight:"4px",marginLeft:"4px;"}},S.createElement(L.A,{className:"ac-button",onClick:this.handleClose},"Cancel"))),S.createElement("div",{style:{height:"20px"}})))))}}const Te=e=>S.createElement("p",{style:{display:"inline"}},`${(0,k.m)((0,b.H)(e.worklog.created))} ago`),$e=e=>S.createElement("p",{style:{display:"inline"}},e.worklog.comment),Be=e=>S.createElement("p",{style:{display:"inline"}},e.worklog.timeSpent),qe=e=>{let t=e.worklog.author.avatarUrls&&e.worklog.author.avatarUrls["16x16"]?e.worklog.author.avatarUrls["16x16"]:"";return S.createElement("div",{className:"ac-flex"},S.createElement(Y.A,{size:"small",borderColor:"var(--vscode-dropdown-foreground)!important",src:t}),S.createElement("span",{style:{marginLeft:"4px"}},e.worklog.author.displayName))};class Ke extends S.Component{constructor(e){super(e)}render(){return S.createElement(W.A,{columns:[qe,$e,Be,Te],columnWidths:["100%","100%","150px","150px"],items:this.props.worklogs.worklogs.map((e=>({id:e.id,content:{worklog:e}})))})}}var He=function(e,t,s,a){return new(s||(s=Promise))((function(i,n){function l(e){try{c(a.next(e))}catch(e){n(e)}}function r(e){try{c(a.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,r)}c((a=a.apply(e,t||[])).next())}))};const Ge=Object.assign(Object.assign(Object.assign({},O.b),N.t),{showMore:!1,currentInlineDialog:""});class Qe extends O.i{constructor(e){super(e),this.advancedSidebarFields=[],this.advancedMainFields=[],this.getProjectKey=()=>this.state.key.substring(0,this.state.key.indexOf("-")),this.handleCopyIssueLink=()=>{this.postMessage({action:"copyJiraIssueLink"})},this.handleStartWorkOnIssue=()=>{this.postMessage({action:"openStartWorkPage",issue:{key:this.state.key,siteDetails:this.state.siteDetails}})},this.fetchUsers=e=>this.loadSelectOptions(e,`${this.state.siteDetails.baseApiUrl}/api/${this.state.apiVersion}/user/search?${this.state.siteDetails.isCloud?"query":"username"}=`),this.handleInlineEdit=(e,t)=>He(this,void 0,void 0,(function*(){switch(e.uiType){case y.HC.Subtasks:{this.setState({isSomethingLoading:!0,loadingField:e.key});const s=t;s.project={key:this.getProjectKey()},s.parent={key:this.state.key},this.postMessage({action:"createIssue",site:this.state.siteDetails,issueData:{fields:s}});break}case y.HC.IssueLinks:this.setState({isSomethingLoading:!0,loadingField:"issuelinks"}),this.postMessage({action:"createIssueLink",site:this.state.siteDetails,issueLinkData:{type:{id:t.type.id},inwardIssue:"inward"===t.type.type?{key:t.issueKey}:{key:this.state.key},outwardIssue:"outward"===t.type.type?{key:t.issueKey}:{key:this.state.key}},issueLinkType:t.type});break;case y.HC.Timetracking:{let s=this.state.fieldValues[e.key];s?s.originalEstimate=t:s={originalEstimate:t},this.setState({loadingField:e.key,isSomethingLoading:!0,fieldValues:Object.assign(Object.assign({},this.state.fieldValues),{[e.key]:s})}),yield this.handleEditIssue(`${e.key}`,{originalEstimate:t});break}case y.HC.Worklog:this.setState({isSomethingLoading:!0,loadingField:e.key}),this.postMessage({action:"createWorklog",site:this.state.siteDetails,worklogData:t,issueKey:this.state.key});break;default:{let s=t;s&&e.valueType===y.eV.Number&&"number"!==typeof t&&(s=parseFloat(t)),this.setState({loadingField:e.key,fieldValues:Object.assign(Object.assign({},this.state.fieldValues),{[e.key]:s})}),void 0===s&&(s=null),yield this.handleEditIssue(e.key,s);break}}})),this.handleEditIssue=(e,t)=>He(this,void 0,void 0,(function*(){this.setState({isSomethingLoading:!0,loadingField:e});const s=w().v4();yield this.postMessageWithEventPromise({action:"editIssue",fields:{[e]:t},nonce:s},"editIssueDone",D.Q,s)})),this.handleCreateComment=(e,t)=>{this.setState({isSomethingLoading:!0,loadingField:"comment"});let s={action:"comment",issue:{key:this.state.key,siteDetails:this.state.siteDetails},commentBody:e,restriction:t};this.postMessage(s)},this.handleUpdateComment=(e,t,s)=>{const a={action:"comment",issue:{key:this.state.key,siteDetails:this.state.siteDetails},commentBody:e,commentId:t,restriction:s};this.postMessage(a)},this.handleDeleteComment=e=>{this.postMessage({action:"deleteComment",issue:{key:this.state.key,siteDetails:this.state.siteDetails},commentId:e})},this.handleStatusChange=e=>{this.setState({isSomethingLoading:!0,loadingField:"status"}),this.postMessage({action:"transitionIssue",transition:e,issue:{key:this.state.key,siteDetails:this.state.siteDetails}})},this.handleOpenWorklogEditor=()=>{"worklog"!==this.state.currentInlineDialog?this.setState({currentInlineDialog:"worklog",isSomethingLoading:!0}):this.setState({currentInlineDialog:"",isSomethingLoading:!1})},this.handleOpenWatchesEditor=()=>{"watches"!==this.state.currentInlineDialog?this.setState({currentInlineDialog:"watches",isSomethingLoading:!0}):this.setState({currentInlineDialog:"",isSomethingLoading:!1})},this.handleOpenVotesEditor=()=>{"votes"!==this.state.currentInlineDialog?this.setState({currentInlineDialog:"votes",isSomethingLoading:!0}):this.setState({currentInlineDialog:"",isSomethingLoading:!1})},this.handleOpenAttachmentEditor=()=>{"attachment"!==this.state.currentInlineDialog?this.setState({currentInlineDialog:"attachment",isSomethingLoading:!0}):this.setState({currentInlineDialog:"",isSomethingLoading:!1})},this.handleInlineDialogClose=()=>{this.setState({currentInlineDialog:"",isSomethingLoading:!1})},this.handleInlineDialogSave=(e,t)=>{this.setState({currentInlineDialog:"",isSomethingLoading:!1}),this.handleInlineEdit(e,t)},this.handleAddWatcher=e=>{this.setState({currentInlineDialog:"",isSomethingLoading:!0,loadingField:"watches"}),this.postMessage({action:"addWatcher",site:this.state.siteDetails,issueKey:this.state.key,watcher:e})},this.handleRemoveWatcher=e=>{this.setState({currentInlineDialog:"",isSomethingLoading:!0,loadingField:"watches"}),this.postMessage({action:"removeWatcher",site:this.state.siteDetails,issueKey:this.state.key,watcher:e})},this.handleAddVote=e=>{this.setState({currentInlineDialog:"",isSomethingLoading:!0,loadingField:"votes"}),this.postMessage({action:"addVote",site:this.state.siteDetails,issueKey:this.state.key,voter:e})},this.handleRemoveVote=e=>{this.setState({currentInlineDialog:"",isSomethingLoading:!0,loadingField:"votes"}),this.postMessage({action:"removeVote",site:this.state.siteDetails,issueKey:this.state.key,voter:e})},this.handleAddAttachments=e=>{this.setState({currentInlineDialog:"",isSomethingLoading:!1,loadingField:"attachment"});const t=e.map((e=>({lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,path:e.path})));this.postMessage({action:"addAttachments",site:this.state.siteDetails,issueKey:this.state.key,files:t})},this.handleDeleteAttachment=e=>{this.setState({isSomethingLoading:!0,loadingField:"attachment"}),this.postMessage({action:"deleteAttachment",site:this.state.siteDetails,objectWithId:e})},this.handleRefresh=()=>{this.setState({isSomethingLoading:!0,loadingField:"refresh"}),this.postMessage({action:"refreshIssue"})},this.handleDeleteIssuelink=e=>{this.setState({isSomethingLoading:!0,loadingField:"issuelinks"}),this.postMessage({action:"deleteIssuelink",site:this.state.siteDetails,objectWithId:e})},this.state=Ge}onMessageReceived(e){let t=super.onMessageReceived(e);if(!t)switch(e.type){case"update":{const t=e;this.updateInternals(t),this.setState(Object.assign(Object.assign({},t),{isErrorBannerOpen:!1,errorDetails:void 0,isSomethingLoading:!1,loadingField:""}));break}case"epicChildrenUpdate":this.setState({isSomethingLoading:!1,loadingField:"",epicChildren:e.epicChildren});break;case"pullRequestUpdate":this.setState({recentPullRequests:e.recentPullRequests});break;case"currentUserUpdate":this.setState({currentUser:e.currentUser});break;case"issueCreated":(0,N.QX)(e)&&this.setState({isSomethingLoading:!1,loadingField:""})}return t}updateInternals(e){const t=this.sortFieldValues(e.fields);this.advancedMainFields=[],this.advancedSidebarFields=[],t.forEach((e=>{e.advanced&&(e.uiType===y.HC.Input&&e.isMultiline?this.advancedMainFields.push(e):this.advancedSidebarFields.push(e))}))}getMainPanelHeaderMarkup(){const e=this.state.fieldValues[this.state.epicFieldInfo.epicLink.id];let t="";e&&("object"===typeof e&&e.value?t=e.value:"string"===typeof e&&(t=e));const s=this.state.fieldValues.parent&&this.state.fieldValues.parent.issuetype?this.state.fieldValues.parent.issuetype.iconUrl:void 0,a=this.state.fieldValues.issuetype?this.state.fieldValues.issuetype.iconUrl:void 0;return S.createElement("div",null,this.state.showPMF&&S.createElement(M.A,{onPMFOpen:()=>this.onPMFOpen(),onPMFVisiblity:e=>this.setState({showPMF:e}),onPMFLater:()=>this.onPMFLater(),onPMFNever:()=>this.onPMFNever(),onPMFSubmit:e=>this.onPMFSubmit(e)}),S.createElement("div",{className:"ac-page-header"},S.createElement("div",{className:"ac-breadcrumbs"},e&&""!==t&&S.createElement(S.Fragment,null,S.createElement(ve.A,{text:t,onItemClick:()=>this.handleOpenIssue({siteDetails:this.state.siteDetails,key:t})}),S.createElement("span",{className:"ac-breadcrumb-divider"},"/")),this.state.fieldValues.parent&&S.createElement(S.Fragment,null,S.createElement(ve.A,{text:this.state.fieldValues.parent.key,iconUrl:s,onItemClick:()=>this.handleOpenIssue({siteDetails:this.state.siteDetails,key:this.state.fieldValues.parent})}),S.createElement("span",{className:"ac-breadcrumb-divider"},"/")),S.createElement(v.A,{content:`Created on ${this.state.fieldValues["created.rendered"]||this.state.fieldValues.created}`},S.createElement(ve.A,{text:`${this.state.key}`,href:`${this.state.siteDetails.baseLinkUrl}/browse/${this.state.key}`,iconUrl:a,onCopy:this.handleCopyIssueLink}))),S.createElement("h2",null,this.getInputMarkup(this.state.fields.summary,!0))),this.state.isErrorBannerOpen&&S.createElement(V.A,{onDismissError:this.handleDismissError,errorDetails:this.state.errorDetails}))}getMainPanelBodyMarkup(){var e;return S.createElement("div",null,this.state.fields.description&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},this.state.fields.description.name),this.getInputMarkup(this.state.fields.description,!0)),this.state.fields.attachment&&this.state.fieldValues.attachment&&this.state.fieldValues.attachment.length>0&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},this.state.fields.attachment.name),S.createElement(H,{baseLinkUrl:this.state.siteDetails.baseLinkUrl,onDelete:this.handleDeleteAttachment,attachments:this.state.fieldValues.attachment,fetchImage:e=>He(this,void 0,void 0,(function*(){const t=w().v4();return(yield this.postMessageWithEventPromise({action:"getImage",nonce:t,url:e},"getImageDone",D.Q,t)).imgData}))})),this.state.fields.environment&&this.state.fieldValues.environment&&""!==this.state.fieldValues.environment.trim()&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},this.state.fields.environment.name),this.getInputMarkup(this.state.fields.environment,!0)),this.state.isEpic&&this.state.epicChildren.length>0&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},"Issues in this epic"),S.createElement(he,{issues:this.state.epicChildren,onIssueClick:this.handleOpenIssue})),this.state.fields.subtasks&&this.state.fieldValues.subtasks&&!this.state.isEpic&&!this.state.fieldValues.issuetype.subtask&&S.createElement("div",{className:"ac-vpadding"},this.getInputMarkup(this.state.fields.subtasks,!0),S.createElement(he,{issues:this.state.fieldValues.subtasks,onIssueClick:this.handleOpenIssue})),this.state.fields.issuelinks&&S.createElement("div",{className:"ac-vpadding"},this.getInputMarkup(this.state.fields.issuelinks,!0),S.createElement(Ee,{issuelinks:this.state.fieldValues.issuelinks,onIssueClick:this.handleOpenIssue,onDelete:this.handleDeleteIssuelink})),this.state.fields.worklog&&Array.isArray(null===(e=this.state.fieldValues.worklog)||void 0===e?void 0:e.worklogs)&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},this.state.fields.worklog.name),S.createElement(Ke,{worklogs:this.state.fieldValues.worklog})),this.advancedMain(),this.state.fields.comment&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},this.state.fields.comment.name),this.state.fieldValues.comment.comments.map((e=>S.createElement(ie,{key:`${e.id}::${e.updated}`,siteDetails:this.state.siteDetails,isServiceDeskProject:this.state.fieldValues.project&&"service_desk"===this.state.fieldValues.project.projectTypeKey,comment:e,fetchUsers:this.fetchUsers,onSave:this.handleUpdateComment,onDelete:this.handleDeleteComment,fetchImage:e=>He(this,void 0,void 0,(function*(){const t=w().v4();return(yield this.postMessageWithEventPromise({action:"getImage",nonce:t,url:e},"getImageDone",D.Q,t)).imgData}))}))),this.getInputMarkup(this.state.fields.comment,!0)))}commonSidebar(){const e=this.state.fieldValues.timetracking?this.state.fieldValues.timetracking.originalEstimate:"",t=this.state.fieldValues.watches&&this.state.fieldValues.watches.watchCount>0?this.state.fieldValues.watches.watchCount:"",s=this.state.fieldValues.votes&&this.state.fieldValues.votes.votes>0?this.state.fieldValues.votes.votes:"",p=this.state.fieldValues.reporter&&this.state.currentUser&&this.state.fieldValues.reporter.accountId!==this.state.currentUser.accountId;return S.createElement(S.Fragment,null,S.createElement(a.A,null,S.createElement(v.A,{content:"Refresh"},S.createElement(i.A,{className:"ac-button-secondary",onClick:this.handleRefresh,iconBefore:S.createElement(c.A,{label:"refresh"}),isLoading:"refresh"===this.state.loadingField})),this.state.fields.worklog&&S.createElement("div",{className:"ac-inline-dialog"},S.createElement(u.A,{content:S.createElement(ze,{onSave:e=>this.handleInlineDialogSave(this.state.fields.worklog,e),onCancel:this.handleInlineDialogClose,originalEstimate:e}),isOpen:"worklog"===this.state.currentInlineDialog,onClose:this.handleInlineDialogClose,placement:"left-start"},S.createElement(v.A,{content:"Log work"},S.createElement(i.A,{className:"ac-button-secondary",onClick:this.handleOpenWorklogEditor,iconBefore:S.createElement(r.A,{label:"Log Work"}),isLoading:"worklog"===this.state.loadingField})))),this.state.fields.attachment&&S.createElement("div",{className:"ac-inline-dialog"},S.createElement(v.A,{content:"Add Attachment"},S.createElement(i.A,{className:"ac-button-secondary",onClick:this.handleOpenAttachmentEditor,iconBefore:S.createElement(l.A,{label:"Add Attachment"}),isLoading:"attachment"===this.state.loadingField})),S.createElement(Q,{isOpen:"attachment"===this.state.currentInlineDialog,onCancel:this.handleInlineDialogClose,onSave:this.handleAddAttachments})),this.state.fields.watches&&S.createElement("div",{className:"ac-inline-dialog"},S.createElement(u.A,{content:S.createElement(Ie,{onFetchUsers:e=>He(this,void 0,void 0,(function*(){return yield this.fetchUsers(e)})),onAddWatcher:this.handleAddWatcher,onRemoveWatcher:this.handleRemoveWatcher,currentUser:this.state.currentUser,onClose:this.handleInlineDialogClose,watches:this.state.fieldValues.watches}),isOpen:"watches"===this.state.currentInlineDialog,onClose:this.handleInlineDialogClose,placement:"left-start"},S.createElement(v.A,{content:"Watch options"},S.createElement(i.A,{className:"ac-button-secondary",onClick:this.handleOpenWatchesEditor,iconBefore:this.state.fieldValues.watches.isWatching?S.createElement(m.A,{label:"Watches"}):S.createElement(h.A,{label:"Watches"}),isLoading:"watches"===this.state.loadingField},t)))),this.state.fields.votes&&S.createElement("div",{className:"ac-inline-dialog"},S.createElement(u.A,{content:S.createElement(Se,{onAddVote:this.handleAddVote,onRemoveVote:this.handleRemoveVote,currentUser:this.state.currentUser,onClose:this.handleInlineDialogClose,allowVoting:p,votes:this.state.fieldValues.votes}),isOpen:"votes"===this.state.currentInlineDialog,onClose:this.handleInlineDialogClose,placement:"left-start"},S.createElement(v.A,{content:"Vote options"},S.createElement(i.A,{className:"ac-button-secondary",onClick:this.handleOpenVotesEditor,iconBefore:this.state.fieldValues.votes.hasVoted?S.createElement(d.A,{label:"Votes"}):S.createElement(o.A,{label:"Votes"}),isLoading:"votes"===this.state.loadingField},s)))),S.createElement(v.A,{content:"Create a branch and transition this issue"},S.createElement(i.A,{className:"ac-button",onClick:this.handleStartWorkOnIssue,iconBefore:S.createElement(n.A,{label:"Start work"}),isLoading:!1},"Start work"))),this.state.fields.status&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},this.state.fields.status.name),S.createElement(ye.N,{transitions:this.state.selectFieldOptions.transitions,currentStatus:this.state.fieldValues.status,isStatusButtonLoading:"status"===this.state.loadingField,onStatusChange:this.handleStatusChange})),this.state.fields.assignee&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},this.state.fields.assignee.name),this.getInputMarkup(this.state.fields.assignee,!0)),this.state.fields.reporter&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},this.state.fields.reporter.name),this.getInputMarkup(this.state.fields.reporter,!0)),this.state.fields.labels&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},this.state.fields.labels.name),this.getInputMarkup(this.state.fields.labels,!0)),this.state.fields.priority&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},this.state.fields.priority.name),this.getInputMarkup(this.state.fields.priority,!0)),this.state.fields.components&&S.createElement("div",{className:"ac-vpadding",onClick:e=>e.stopPropagation()},S.createElement("label",{className:"ac-field-label"},this.state.fields.components.name),this.getInputMarkup(this.state.fields.components,!0)),this.state.fields.fixVersions&&S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},this.state.fields.fixVersions.name),this.getInputMarkup(this.state.fields.fixVersions,!0)))}advancedSidebar(){let e=[];return this.advancedSidebarFields.forEach((t=>{t.advanced&&t.uiType!==y.HC.NonEditable&&(t.uiType===y.HC.Timetracking&&(t.name="Original estimate"),e.push(S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},t.name),this.getInputMarkup(t,!0))))})),this.state.recentPullRequests&&this.state.recentPullRequests.length>0&&e.push(S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},"Recent pull requests"),S.createElement(fe,{pullRequests:this.state.recentPullRequests,onClick:e=>this.postMessage({action:"openPullRequest",prHref:e.url})}))),S.createElement(A.A,{trigger:"show more",triggerWhenOpen:"show less",triggerClassName:"ac-collapsible-trigger",triggerOpenedClassName:"ac-collapsible-trigger",triggerTagName:"label",easing:"ease-out",transitionTime:150,overflowWhenOpen:"visible"},e)}advancedMain(){let e=[];return this.advancedMainFields.forEach((t=>{t.advanced&&t.uiType!==y.HC.NonEditable&&e.push(S.createElement("div",{className:"ac-vpadding"},S.createElement("label",{className:"ac-field-label"},t.name),this.getInputMarkup(t,!0)))})),e}createdUpdatedDates(){let e,t;try{e=`Created ${(0,k.m)((0,b.H)(this.state.fieldValues.created))} ago`,t=`Updated ${(0,k.m)((0,b.H)(this.state.fieldValues.updated))} ago`}catch(s){e=this.state.fieldValues["created.rendered"]||this.state.fieldValues.created,t=this.state.fieldValues["updated.rendered"]||this.state.fieldValues.updated}return S.createElement("div",{className:"ac-issue-created-updated"},e&&S.createElement("div",null,e),t&&S.createElement("div",null,t))}render(){return(Object.keys(this.state.fields).length<1||Object.keys(this.state.fieldValues).length<1)&&!this.state.isErrorBannerOpen&&this.state.isOnline?(this.postMessage({action:"refreshIssue"}),S.createElement(I.V,null)):this.state.isOnline?S.createElement(p.Ay,null,S.createElement(f.A,null,(e=>e&&e<800?S.createElement("div",{style:{margin:"20px 16px 0px 16px"}},this.getMainPanelHeaderMarkup(),this.commonSidebar(),this.getMainPanelBodyMarkup(),this.advancedSidebar(),this.createdUpdatedDates()):S.createElement("div",{style:{maxWidth:"1200px",margin:"20px auto 0 auto"}},S.createElement(g.A,{layout:"fluid"},S.createElement(E.A,{medium:8},this.getMainPanelHeaderMarkup(),this.getMainPanelBodyMarkup()),S.createElement(E.A,{medium:4},this.commonSidebar(),this.advancedSidebar(),this.createdUpdatedDates())))))):S.createElement(x.A,null)}}},82522:(e,t,s)=>{s.d(t,{A:()=>r});var a=s(96540),i=s(50653),n=s(12908),l=s(76234);class r extends a.Component{render(){return a.createElement("div",{className:"ac-icon-with-text"},this.props.iconUrl&&a.createElement("img",{style:{paddingRight:"5px"},src:this.props.iconUrl}),a.createElement("div",{className:"jira-issue-key"},a.createElement(i.A,{className:"ac-link-button",appearance:"link",spacing:"none",href:this.props.href,onClick:this.props.onItemClick},this.props.text),this.props.onCopy&&a.createElement("div",{className:"jira-issue-copy-icon",onClick:this.props.onCopy},a.createElement(n.A,{content:"Copy the web link to clipboard"},a.createElement(l.A,{label:"copy issue link",size:"small"})))))}}},99650:(e,t,s)=>{s.d(t,{N:()=>u});var a=s(10453),i=s(23588),n=s(24788),l=s(72007),r=s(96540),c=s(79402);const{Option:o}=i.c,d=e=>r.createElement(o,Object.assign({},e),r.createElement(a.A,{appearance:c.zK[e.data.to.statusCategory.colorName]},e.data.to.name)),h=e=>r.createElement(o,Object.assign({},e),`${e.data.name} \u2192 `,r.createElement(a.A,{appearance:c.zK[e.data.to.statusCategory.colorName]},e.data.to.name)),m=e=>r.createElement(i.c.SingleValue,Object.assign({},e),r.createElement(a.A,{appearance:c.zK[e.data.to.statusCategory.colorName]},e.data.to.name));class u extends r.Component{constructor(e){super(e),this.handleStatusChange=e=>{this.props.onStatusChange(e)};const t=this.getCurrentTransition(e.currentStatus,e.transitions);this.state={selectedTransition:t,showTransitionName:this.shouldShowTransitionName(e.transitions)}}componentWillReceiveProps(e){const t=this.getCurrentTransition(e.currentStatus,e.transitions);this.setState({selectedTransition:t,showTransitionName:this.shouldShowTransitionName(e.transitions)})}getCurrentTransition(e,t){const s=t.find((t=>t.to.id===e.id));return void 0!==s?s:Object.assign(Object.assign({},l.rv),{to:e})}shouldShowTransitionName(e){return e.some((e=>e.name!==e.to.name))}render(){return!Array.isArray(this.props.transitions)||this.props.transitions.length<1?r.createElement("div",null):r.createElement(n.A,{name:"status",id:"status",className:"ac-select-container",classNamePrefix:"ac-select",options:this.props.transitions,value:this.state.selectedTransition,components:{Option:this.state.showTransitionName?h:d,SingleValue:m},getOptionLabel:e=>e.to.name,getOptionValue:e=>e.id,isDisabled:this.props.isStatusButtonLoading,isLoading:this.props.isStatusButtonLoading,onChange:this.handleStatusChange})}}}}]);